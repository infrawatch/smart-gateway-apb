FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IHNtYXJ0LWdhdGV3YXktYXBiCmRlc2NyaXB0aW9uOiAiU21hcnQg\
R2F0ZXdheSBmb3IgcHJvdmlkaW5nIG1ldHJpY3MgYW5kIGV2ZW50cyBmcm9tIGFuIEFNUVAgMS54\
IGJ1cyIKYmluZGFibGU6IEZhbHNlCmFzeW5jOiBvcHRpb25hbAptZXRhZGF0YToKICBkaXNwbGF5\
TmFtZTogIlNtYXJ0IEdhdGV3YXkgKEFQQikiCiAgcHJvdmlkZXJEaXNwbGF5TmFtZTogIlJlZCBI\
YXQsIEluYy4iCnBsYW5zOgogIC0gbmFtZTogZGVmYXVsdAogICAgZGVzY3JpcHRpb246IFRoaXMg\
ZGVmYXVsdCBwbGFuIGRlcGxveXMgdGhlIFNtYXJ0IEdhdGV3YXkKICAgIGZyZWU6IFRydWUKICAg\
IG1ldGFkYXRhOgogICAgICAgIGRpc3BsYXlOYW1lOiBEZWZhdWx0CiAgICBwYXJhbWV0ZXJzOgog\
ICAgICAgIC0gbmFtZTogb2NfbG9naW5fdXNlcm5hbWUKICAgICAgICAgIHR5cGU6IHN0cmluZwog\
ICAgICAgICAgdGl0bGU6IE9wZW5TaGlmdCBhZG1pbmlzdHJhdGlvbiBsb2dpbiB1c2VybmFtZQog\
ICAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICAgIGRpc3BsYXlfZ3JvdXA6IE9wZW5TaGlm\
dCBDcmVkZW50aWFscwogICAgICAgIC0gbmFtZTogb2NfbG9naW5fcGFzc3dvcmQKICAgICAgICAg\
IHR5cGU6IHN0cmluZwogICAgICAgICAgdGl0bGU6IE9wZW5TaGlmdCBhZG1pbmlzdHJhdGlvbiBs\
b2dpbiBwYXNzd29yZAogICAgICAgICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAogICAgICAgICAg\
cmVxdWlyZWQ6IHRydWUKICAgICAgICAgIGRpc3BsYXlfZ3JvdXA6IE9wZW5TaGlmdCBDcmVkZW50\
aWFscwogICAgICAgIC0gbmFtZTogc2dfdHlwZQogICAgICAgICAgdGl0bGU6IFR5cGUgb2YgU21h\
cnQgR2F0ZXdheSB0byBkZXBsb3kKICAgICAgICAgIHR5cGU6IGVudW0KICAgICAgICAgIGVudW06\
IFsnbWV0cmljcycsICdldmVudHMnXQogICAgICAgICAgZGVmYXVsdDogbWV0cmljcwogICAgICAg\
ICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICAtIG5hbWU6IHNnX2xhYmVsCiAgICAgICAgICB0aXRs\
ZTogVW5pcXVlIGxhYmVsIGZvciBTbWFydCBHYXRld2F5CiAgICAgICAgICB0eXBlOiBzdHJpbmcK\
ICAgICAgICAgIGRpc3BsYXlfdHlwZTogdGV4dAogICAgICAgICAgZGVmYXVsdDogIndoaXRlIgog\
ICAgICAgICAgcmVxdWlyZWQ6IHRydWUK"

COPY playbooks/* /opt/apb/project/
COPY roles/smart_gateway /opt/apb/project/roles/smart_gateway
RUN chmod -R g=u /opt/{ansible,apb}
USER apb
